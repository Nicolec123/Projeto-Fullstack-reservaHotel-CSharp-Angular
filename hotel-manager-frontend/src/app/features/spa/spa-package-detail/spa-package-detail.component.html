@if (loading()) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>
} @else {
  @if (packageData(); as pkg) {
    @if (packageDetail(); as detail) {
    <div class="detail-page">
      <a routerLink="/" class="back-link">‚Üê Voltar</a>

      <header class="detail-header">
        <div class="package-badge">{{ pkg.duracao }}</div>
        <h1>{{ pkg.titulo }}</h1>
        <p class="package-description">{{ pkg.descricao }}</p>
        <p class="preco">{{ formatarPreco(pkg.precoBase) }} <span>/ pacote</span></p>
      </header>

      <div class="detail-content">
        <!-- Galeria de Imagens -->
        <div class="gallery-section">
          @if (detail.imagens.length > 0) {
            <div class="gallery-main">
              <img [src]="detail.imagens[imageIndex()]" [alt]="pkg.titulo" />
              @if (detail.imagens.length > 1) {
                <button type="button" class="gallery-btn prev" (click)="prevImage()" aria-label="Anterior">‚Äπ</button>
                <button type="button" class="gallery-btn next" (click)="nextImage()" aria-label="Pr√≥xima">‚Ä∫</button>
                <div class="gallery-dots">
                  @for (img of detail.imagens; track $index) {
                    <button type="button" class="dot" [class.active]="imageIndex() === $index" (click)="imageIndex.set($index)"></button>
                  }
                </div>
              }
            </div>
          }
        </div>

        <!-- Galeria do Quarto Padr√£o -->
        @if (detail.imagensQuarto && detail.imagensQuarto.length > 0) {
          <div class="room-gallery-section">
            <h2>üè® O Quarto Padr√£o Inclu√≠do</h2>
            <p class="room-gallery-intro">Conhe√ßa o quarto padr√£o onde voc√™ se hospedar√° durante sua estadia:</p>
            <div class="room-gallery-main">
              <img [src]="detail.imagensQuarto[roomImageIndex()]" [alt]="'Quarto Padr√£o - ' + pkg.titulo" />
              @if (detail.imagensQuarto.length > 1) {
                <button type="button" class="gallery-btn prev" (click)="prevRoomImage()" aria-label="Anterior">‚Äπ</button>
                <button type="button" class="gallery-btn next" (click)="nextRoomImage()" aria-label="Pr√≥xima">‚Ä∫</button>
                <div class="gallery-dots">
                  @for (img of detail.imagensQuarto; track $index) {
                    <button type="button" class="dot" [class.active]="roomImageIndex() === $index" (click)="roomImageIndex.set($index)"></button>
                  }
                </div>
              }
            </div>
          </div>
        }

        <!-- V√≠deo do Quarto (se dispon√≠vel) -->
        @if (detail.videoUrl) {
          <div class="video-section">
            <h2>üìπ Tour Virtual do Quarto</h2>
            <div class="video-wrapper">
              <iframe 
                [src]="detail.videoUrl" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
              </iframe>
            </div>
          </div>
        }

        <!-- Descri√ß√£o Completa -->
        <div class="info-section">
          <section class="desc-block">
            <h2>üìã Sobre o Pacote</h2>
            <p>{{ detail.descricaoCompleta }}</p>
          </section>

          <!-- O que est√° inclu√≠do -->
          <section class="desc-block">
            <h2>‚úÖ {{ detail.oQueEstaIncluido.titulo }}</h2>
            <ul class="includes-list">
              @for (item of detail.oQueEstaIncluido.itens; track item) {
                <li>{{ item }}</li>
              }
            </ul>
          </section>

          <!-- O que n√£o est√° inclu√≠do -->
          <section class="desc-block">
            <h2>‚ùå {{ detail.oQueNaoEstaIncluido.titulo }}</h2>
            <ul class="excludes-list">
              @for (item of detail.oQueNaoEstaIncluido.itens; track item) {
                <li>{{ item }}</li>
              }
            </ul>
          </section>

          <!-- Informa√ß√µes do Quarto -->
          <section class="desc-block room-details-section">
            <h2>üè® Informa√ß√µes do Quarto Padr√£o</h2>
            
            @if (detail.informacoesQuarto.descricaoCompleta) {
              <p class="room-full-description">{{ detail.informacoesQuarto.descricaoCompleta }}</p>
            }
            
            <div class="info-grid">
              <div class="info-item">
                <strong>Tipo:</strong> {{ detail.informacoesQuarto.tipo }}
              </div>
              <div class="info-item">
                <strong>Metragem:</strong> {{ detail.informacoesQuarto.metragem }}
              </div>
              <div class="info-item">
                <strong>Capacidade:</strong> {{ detail.informacoesQuarto.capacidade }}
              </div>
            </div>

            @if (detail.informacoesQuarto.vista) {
              <div class="room-detail-item">
                <h3>ü™ü Vista e Ambiente</h3>
                <p>{{ detail.informacoesQuarto.vista }}</p>
              </div>
            }

            @if (detail.informacoesQuarto.banheiro) {
              <div class="room-detail-item">
                <h3>üõÅ Banheiro</h3>
                <p>{{ detail.informacoesQuarto.banheiro }}</p>
              </div>
            }

            <div class="equipamentos-section">
              <h3>üì∫ Equipamentos e Conforto</h3>
              <ul class="equipamentos-list">
                @for (equipamento of detail.informacoesQuarto.equipamentos; track equipamento) {
                  <li>{{ equipamento }}</li>
                }
              </ul>
            </div>

            @if (detail.informacoesQuarto.experiencia) {
              <div class="room-detail-item experiencia">
                <h3>‚ú® Experi√™ncia</h3>
                <p>{{ detail.informacoesQuarto.experiencia }}</p>
              </div>
            }
          </section>

          <!-- Informa√ß√µes do Spa -->
          <section class="desc-block">
            <h2>üíÜ Informa√ß√µes do Spa</h2>
            <div class="spa-info">
              <div class="spa-section">
                <strong>Tratamentos Inclu√≠dos:</strong>
                <ul class="spa-list">
                  @for (tratamento of detail.informacoesSpa.tratamentos; track tratamento) {
                    <li>{{ tratamento }}</li>
                  }
                </ul>
              </div>
              <div class="spa-section">
                <strong>Acessos:</strong>
                <ul class="spa-list">
                  @for (acesso of detail.informacoesSpa.acessos; track acesso) {
                    <li>{{ acesso }}</li>
                  }
                </ul>
              </div>
              <div class="spa-section">
                <strong>Dura√ß√£o:</strong> {{ detail.informacoesSpa.duracao }}
              </div>
            </div>
          </section>

          <!-- Informa√ß√µes Adicionais -->
          <section class="desc-block">
            <h2>‚ÑπÔ∏è Informa√ß√µes Adicionais</h2>
            <ul class="additional-info-list">
              @for (info of detail.informacoesAdicionais; track info) {
                <li>{{ info }}</li>
              }
            </ul>
          </section>

          <!-- Destaques do Pacote -->
          <section class="desc-block highlights">
            <h2>‚ú® Destaques do Pacote</h2>
            <div class="highlights-grid">
              <div class="highlight-item">
                <span class="highlight-icon">üåô</span>
                <span>{{ pkg.noites }} noite{{ pkg.noites > 1 ? 's' : '' }}</span>
              </div>
              <div class="highlight-item">
                <span class="highlight-icon">üë•</span>
                <span>{{ pkg.pessoasIncluidas || 1 }} pessoa{{ (pkg.pessoasIncluidas || 1) > 1 ? 's' : '' }} inclu√≠da{{ (pkg.pessoasIncluidas || 1) > 1 ? 's' : '' }}</span>
              </div>
              <div class="highlight-item">
                <span class="highlight-icon">üè®</span>
                <span>Quarto {{ pkg.tipoQuarto === 'suite' ? 'Su√≠te' : pkg.tipoQuarto === 'suite-premium' ? 'Su√≠te Premium' : 'Padr√£o' }}</span>
              </div>
              <div class="highlight-item">
                <span class="highlight-icon">üíÜ</span>
                <span>Tratamentos de Spa</span>
              </div>
            </div>
          </section>

          <!-- Avalia√ß√µes -->
          @if (spaReviews.length > 0) {
            <section class="reviews-section">
              <h2>‚≠ê Avalia√ß√µes dos Clientes</h2>
              <div class="reviews-list">
                @for (review of spaReviews; track review.nome + review.data) {
                  <div class="review-card">
                    <div class="review-header">
                      <img [src]="review.avatarUrl" [alt]="review.nome" class="review-avatar" />
                      <div class="review-meta">
                        <strong>{{ review.nome }}</strong>
                        <span class="review-date">{{ review.data }}</span>
                        <div class="review-stars" [attr.aria-label]="review.nota + ' de 5 estrelas'">
                          @for (star of [1,2,3,4,5]; track star) {
                            <span class="star" [class.filled]="star <= review.nota">‚òÖ</span>
                          }
                        </div>
                      </div>
                    </div>
                    <p class="review-text">{{ review.texto }}</p>
                  </div>
                }
              </div>
            </section>
          }

          <!-- A√ß√µes -->
          <div class="detail-actions">
            <button type="button" class="btn btn-reserve" (click)="irParaReserva()">
              Reservar Agora
            </button>
            <a routerLink="/" class="btn btn-secondary">Voltar ao In√≠cio</a>
          </div>
        </div>
      </div>
    </div>
    }
  }
}
